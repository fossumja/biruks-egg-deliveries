<section class="card hero">
  <div class="actions">
    <button
      type="button"
      class="btn btn-secondary btn-outline-primary"
      (click)="onImportClick(fileInput)"
      [disabled]="isImporting"
    >
      {{ isImporting ? "Importing…" : "Import CSV" }}
    </button>
    <button
      type="button"
      class="btn btn-secondary"
      (click)="exportCsv()"
      [disabled]="isExporting"
    >
      {{ isExporting ? "Preparing…" : "Backup (CSV)" }}
    </button>
    <input
      #fileInput
      type="file"
      accept=".csv,text/csv"
      hidden
      (change)="onFileSelected($event)"
    />
  </div>
  <div class="subtext text-muted" *ngIf="lastBackupAt">
    Last backup: {{ lastBackupAt | date : "short" }}
    <span *ngIf="showImportHint">
      — tap “Import CSV” again to choose a file.
    </span>
  </div>
  <div class="subtext text-muted" *ngIf="lastImportAt">
    Imported: {{ lastImportAt | date : "short" }}
  </div>
  <div class="error" *ngIf="errorMessage">{{ errorMessage }}</div>
</section>

<section class="card settings-card">
  <div class="settings-row">
    <div>
      <div class="settings-title">Dark mode</div>
      <div class="text-muted settings-subtitle">Toggle dark mode.</div>
    </div>
    <button
      type="button"
      class="btn"
      [ngClass]="darkModeEnabled ? 'btn-primary' : 'btn-secondary'"
      (click)="toggleDarkMode()"
      title="Dark mode"
    >
      {{ darkModeEnabled ? "On" : "Off" }}
    </button>
  </div>
</section>

<section class="card settings-card">
  <div class="settings-row">
    <div>
      <div class="settings-title">Drag to reorder on Planner</div>
      <div class="text-muted settings-subtitle">
        When on, you can drag people to change their route order.
      </div>
    </div>
    <button
      type="button"
      class="btn"
      [ngClass]="plannerReorderDefaultEnabled ? 'btn-primary' : 'btn-secondary'"
      (click)="togglePlannerReorderDefault()"
      title="Toggle drag-to-reorder on Planner"
    >
      {{ plannerReorderDefaultEnabled ? "On" : "Off" }}
    </button>
  </div>
</section>

<section class="card settings-card">
  <div class="settings-row">
    <div>
      <div class="settings-title">Keep screen awake</div>
      <div class="text-muted settings-subtitle">
        Prevents the display from sleeping while you use the app.
      </div>
    </div>
    <button
      type="button"
      class="btn"
      [ngClass]="wakeLockActive ? 'btn-primary' : 'btn-secondary'"
      (click)="toggleWakeLock()"
      [disabled]="!wakeLockSupported"
      title="Keep the screen awake while using the app"
    >
      {{ wakeLockActive ? "On" : "Off" }}
    </button>
  </div>
  <div class="text-muted" *ngIf="!wakeLockSupported">
    Screen wake lock is not supported on this device/browser.
  </div>
</section>

<section class="card settings-card">
  <div class="settings-row">
    <div>
      <div class="settings-title">Suggested donation/dozen</div>
      <div class="text-muted settings-subtitle">
        Used across planner and run screens.
      </div>
    </div>
    <div class="qty-picker">
      <button type="button" class="qty-btn" (click)="changeSuggested(-1)">
        −
      </button>
      <span class="qty-display">${{ suggestedRate }}</span>
      <button type="button" class="qty-btn" (click)="changeSuggested(1)">
        +
      </button>
    </div>
  </div>
</section>

<section class="card build-card" *ngIf="buildInfo as info">
  <div class="text-muted small">
    Updated
    {{ info.builtAt | date : "yyyy-MM-dd HH:mm:ss" : undefined : "en-US" }}
    <span *ngIf="info.commit"> (commit {{ info.commit.slice(0, 7) }})</span>
  </div>
</section>
