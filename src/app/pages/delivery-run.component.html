<div class="run-screen">
  <div class="header">
  </div>

  <div *ngIf="loading" class="status text-muted">Loadingâ€¦</div>
  <div *ngIf="errorMessage" class="status error">{{ errorMessage }}</div>

  <main *ngIf="!loading && !errorMessage" class="content">
    <div class="delivery-card card" *ngIf="!finished && currentStop" [@cardChange]="currentStop.id ? 'in' : 'void'">
      <app-stop-delivery-card
        [stop]="currentStop"
        [deliveredQty]="deliveredQty"
        [donation]="currentDonation"
        [suggestedAmount]="suggestedDonationAmount"
        [showNoDonation]="true"
        [allowDonationReselect]="true"
        (adjustQty)="adjustDelivered($event)"
        (donationStatusChange)="setDonationStatus($event)"
        (donationMethodChange)="setDonationDonated($event)"
        (amountChange)="onInlineAmountChange($event)"
        (copyAddress)="copyAddress()"
        (openMap)="openMaps()"
      />
    </div>

    <div class="next-up card" *ngIf="nextStop">
      <div class="section-title">Next up</div>
      <div class="next-name">{{ nextStop.name }}</div>
      <div class="text-muted">
        {{ nextStop.address }}<br />
        {{ nextStop.city }}, {{ nextStop.state }} {{ nextStop.zip }}
      </div>
      <div class="next-meta text-muted">{{ nextStop.dozens }} dozen{{ nextStop.dozens === 1 ? '' : 's' }}</div>
    </div>
  </main>

  <div class="bottom-bar safe-bottom" *ngIf="!loading && !errorMessage && !finished">
    <button class="btn btn-primary" type="button" (click)="markDelivered()">Deliver</button>
    <button class="btn btn-secondary" type="button" (click)="openSkipDialog()">Skip</button>
  </div>

  <div class="actions-complete" *ngIf="finished && !loading && !errorMessage">
    <button type="button" class="btn btn-primary" (click)="backupNow()">Backup now</button>
    <button class="btn btn-secondary" type="button" (click)="finishRoute()">Done</button>
  </div>
</div>

<div class="amount-overlay" *ngIf="showAmountPicker">
  <app-donation-amount-picker
    [currentAmount]="currentDonation.amount"
    [suggestedAmount]="suggestedDonationAmount"
    (cancel)="closeAmountPicker()"
    (save)="confirmAmountFromPicker($event)"
  />
</div>

<div class="skip-overlay" *ngIf="showSkipDialog">
  <div class="skip-dialog card">
    <h3>Skip reason</h3>
    <div class="reason-buttons">
      <button class="btn btn-secondary" type="button" (click)="confirmSkip('Not home')">Not home</button>
      <button class="btn btn-secondary" type="button" (click)="confirmSkip('Canceled')">Canceled</button>
    </div>
    <div class="custom-reason">
      <input [(ngModel)]="otherReason" placeholder="Other reason" />
      <button class="btn btn-primary" type="button" (click)="confirmSkip(otherReason)">Save</button>
    </div>
    <button class="btn btn-text" type="button" (click)="cancelSkip()">Cancel</button>
  </div>
</div>
